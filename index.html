<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0a0f14">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Promo Catalog</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.0/dist/JsBarcode.all.min.js"></script>
    <link rel="stylesheet" href="style.css?v=104">
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ —Å –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π -->
        <header class="main-header">
            <div class="header-top">
                <!-- –í–∫–ª–∞–¥–∫–∏ -->
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab('catalog')" data-tab="catalog">
                        –ö–∞—Ç–∞–ª–æ–≥
                    </button>
                    <button class="tab-btn" onclick="switchTab('favorites')" data-tab="favorites">
                        –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
                    </button>
                    <button class="tab-btn settings-tab" onclick="toggleSettings()" data-tab="settings">
                        ‚öôÔ∏è
                    </button>
                </div>
            </div>
            
            <!-- –ü–æ–∏—Å–∫ -->
            <div class="search-container">
                <input type="search" id="searchInput" placeholder="üîç –ù–∞–π—Ç–∏ –±—Ä–µ–Ω–¥...">
                <button class="filter-btn" onclick="toggleFilters()">‚â°</button>
            </div>
            
            <!-- –í—ã–±–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
            <div class="category-select-container">
                <button class="category-select-btn" onclick="toggleCategoryModal()">
                    <span id="selectedCategoriesText">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </button>
            </div>
            
            <!-- –§–∏–ª—å—Ç—Ä—ã (—Å–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
            <div id="filtersPanel" class="filters-panel hidden">
                <!-- –§–∏–ª—å—Ç—Ä - –ú–∏–Ω. —Å–∫–∏–¥–∫–∞ -->
                <div class="filter-group">
                    <label>–ú–∏–Ω. —Å–∫–∏–¥–∫–∞:</label>
                    <button class="filter-select-btn" onclick="openFilterModal('discount')">
                        <span id="discountText">–õ—é–±–∞—è</span>
                        <span class="dropdown-arrow">‚ñº</span>
                    </button>
                    <input type="hidden" id="discountFilter" value="0">
                </div>
                
                <!-- –§–∏–ª—å—Ç—Ä - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
                <div class="filter-group">
                    <label>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                    <button class="filter-select-btn" onclick="openFilterModal('sort')">
                        <span id="sortText">–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</span>
                        <span class="dropdown-arrow">‚ñº</span>
                    </button>
                    <input type="hidden" id="sortFilter" value="popularity">
                </div>
                
                <button class="apply-filters-btn" onclick="applyFilters()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
            </div>
            
            <!-- –ù–µ–¥–∞–≤–Ω–∏–µ –ø–æ–∏—Å–∫–∏ -->
            <div id="recentSearches" class="recent-searches hidden"></div>
        </header>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <main id="offersContainer" class="offers-grid">
            <p style="text-align: center; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
        </main>
        
        <!-- –ü—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ -->
        <div id="emptyFavorites" class="empty-state hidden">
            <div class="empty-icon">‚òÜ</div>
            <h3>–í –∏–∑–±—Ä–∞–Ω–Ω–æ–º –ø–æ–∫–∞ –ø—É—Å—Ç–æ</h3>
            <p>–î–æ–±–∞–≤–ª—è–π—Ç–µ –±—Ä–µ–Ω–¥—ã –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, —á—Ç–æ–±—ã –±—ã—Å—Ç—Ä–æ –Ω–∞—Ö–æ–¥–∏—Ç—å –∏—Ö</p>
            <button class="go-catalog-btn" onclick="switchTab('catalog')">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π -->
    <div id="categoryModal" class="modal hidden">
        <div class="modal-content category-modal-content">
            <span class="close" onclick="toggleCategoryModal()">&times;</span>
            <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
            <div id="categoryList" class="category-list">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JS -->
            </div>
            <button class="apply-filters-btn" onclick="applyCategorySelection()">–ü—Ä–∏–º–µ–Ω–∏—Ç—å</button>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ - –ú–∏–Ω. —Å–∫–∏–¥–∫–∞ -->
    <div id="discountModal" class="modal hidden">
        <div class="modal-content filter-modal-content">
            <span class="close" onclick="closeFilterModal('discount')">&times;</span>
            <h3>–ú–∏–Ω. —Å–∫–∏–¥–∫–∞</h3>
            <div class="filter-option" onclick="selectFilter('discount', '0', '–õ—é–±–∞—è')">–õ—é–±–∞—è</div>
            <div class="filter-option" onclick="selectFilter('discount', '500', '–æ—Ç 500 ‚ÇΩ')">–æ—Ç 500 ‚ÇΩ</div>
            <div class="filter-option" onclick="selectFilter('discount', '1000', '–æ—Ç 1000 ‚ÇΩ')">–æ—Ç 1000 ‚ÇΩ</div>
            <div class="filter-option" onclick="selectFilter('discount', '3000', '–æ—Ç 3000 ‚ÇΩ')">–æ—Ç 3000 ‚ÇΩ</div>
            <div class="filter-option" onclick="selectFilter('discount', '5000', '–æ—Ç 5000 ‚ÇΩ')">–æ—Ç 5000 ‚ÇΩ</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ -->
    <div id="sortModal" class="modal hidden">
        <div class="modal-content filter-modal-content">
            <span class="close" onclick="closeFilterModal('sort')">&times;</span>
            <h3>–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞</h3>
            <div class="filter-option" onclick="selectFilter('sort', 'popularity', '–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏')">–ü–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç–∏</div>
            <div class="filter-option" onclick="selectFilter('sort', 'alphabet', '–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É')">–ü–æ –∞–ª—Ñ–∞–≤–∏—Ç—É</div>
            <div class="filter-option" onclick="selectFilter('sort', 'discount', '–ü–æ —Ä–∞–∑–º–µ—Ä—É —Å–∫–∏–¥–∫–∏')">–ü–æ —Ä–∞–∑–º–µ—Ä—É —Å–∫–∏–¥–∫–∏</div>
            <div class="filter-option" onclick="selectFilter('sort', 'newest', '–ü–æ –¥–∞—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è')">–ü–æ –¥–∞—Ç–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—Ñ–µ—Ä–∞ (–ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–µ) -->
    <div id="modal" class="modal offer-modal hidden">
        <div class="modal-content offer-modal-content">
            <!-- Sticky header (—É–º–µ–Ω—å—à–µ–Ω–Ω—ã–π) -->
            <div class="modal-header">
                <h3 id="mBrand">Brand</h3>
                <span class="close" onclick="closeModal()">&times;</span>
            </div>
            
            <div id="mCode" class="modal-body"></div>
            
            <div class="offer-actions">
                <button class="action-btn favorite-btn" onclick="toggleFavoriteFromModal()">
                    <span class="favorite-text">–î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ</span>
                </button>
                
                <button class="action-btn share-btn" onclick="shareOffer()">
                    –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                </button>
            </div>
            
            <div id="additionalSection" class="additional-section" style="display: none;">
                <button class="additional-toggle" onclick="toggleAdditional()">
                    –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
                    <span class="toggle-icon">‚ñº</span>
                </button>
                <div class="additional-content" id="additionalContent"></div>
            </div>
        </div>
    </div>

    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    <div id="settingsModal" class="modal hidden">
        <div class="modal-content settings-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 style="margin: 0; font-size: 22px; color: #ffffff;">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
                <span class="close" onclick="toggleSettings()" style="position: static; width: 36px; height: 36px; font-size: 28px; cursor: pointer; color: rgba(255, 255, 255, 0.7); display: flex; align-items: center; justify-content: center; border-radius: 50%; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1);">&times;</span>
            </div>
            
            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –Ø–∑—ã–∫ -->
            <div class="setting-item">
                <label>–Ø–∑—ã–∫:</label>
                <button class="filter-select-btn" onclick="openFilterModal('language')">
                    <span id="languageText">üá∑üá∫ –†—É—Å—Å–∫–∏–π</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </button>
                <input type="hidden" id="languageSelect" value="ru">
            </div>
            
            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
            <div class="setting-item">
                <label>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:</label>
                <button class="filter-select-btn" onclick="openFilterModal('notifications')">
                    <span id="notificationsText">–í–∫–ª—é—á–µ–Ω—ã</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </button>
                <input type="hidden" id="notificationsSelect" value="true">
            </div>
            
            <div class="setting-item">
                <button class="clear-history-btn" onclick="clearSearchHistory()">
                    –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –ø–æ–∏—Å–∫–∞
                </button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ - –Ø–∑—ã–∫ -->
    <div id="languageModal" class="modal hidden">
        <div class="modal-content filter-modal-content">
            <span class="close" onclick="closeFilterModal('language')">&times;</span>
            <h3>–Ø–∑—ã–∫</h3>
            <div class="filter-option" onclick="selectFilter('language', 'ru', 'üá∑üá∫ –†—É—Å—Å–∫–∏–π')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</div>
            <div class="filter-option" onclick="selectFilter('language', 'en', 'üá¨üáß English')">üá¨üáß English</div>
            <div class="filter-option" onclick="selectFilter('language', 'de', 'üá©üá™ Deutsch')">üá©üá™ Deutsch</div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ - –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notificationsModal" class="modal hidden">
        <div class="modal-content filter-modal-content">
            <span class="close" onclick="closeFilterModal('notifications')">&times;</span>
            <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>
            <div class="filter-option" onclick="selectFilter('notifications', 'true', '–í–∫–ª—é—á–µ–Ω—ã')">–í–∫–ª—é—á–µ–Ω—ã</div>
            <div class="filter-option" onclick="selectFilter('notifications', 'false', '–û—Ç–∫–ª—é—á–µ–Ω—ã')">–û—Ç–∫–ª—é—á–µ–Ω—ã</div>
        </div>
    </div>

    <script src="script.js?v=104"></script>
</body>
</html>
